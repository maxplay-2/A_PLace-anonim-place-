<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>A Place — анонимность</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 20px; color: #000; }
    .wrap { width: 100%; max-width: 700px; margin: auto; }
    .card { border: 1px solid #ccc; border-radius: 8px; padding: 16px; background: #fff; }
    textarea { width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #ccc; font-size: 14px; min-height: 80px; resize: vertical; }
    button { background: #007bff; color: #fff; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; width: 150px; }
    button:hover { background: #0056b3; }
    .comment { border-bottom: 1px solid #ddd; padding: 10px 0; }
    .comment strong { display: block; color: #333; }
    .comment .small { font-size: 12px; color: #777; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Комментарии</h1>
    <div class="card">
      <form id="commentForm">
        <textarea id="text" placeholder="Напишите что-нибудь..." required maxlength="1000"></textarea>
        <button type="submit">Отправить</button>
      </form>
      <div id="comments"></div>
      <p id="summary"></p>
    </div>
  </div>

  <script>
    const form = document.getElementById("commentForm");
    const textInput = document.getElementById("text");
    const commentsEl = document.getElementById("comments");
    const summary = document.getElementById("summary");

    async function loadComments() {
      const res = await fetch("/api/comments");
      const comments = await res.json();
      render(comments);
    }

    function render(comments) {
      commentsEl.innerHTML = "";
      if (comments.length === 0) {
        commentsEl.innerHTML = "<p>Пока нет комментариев — будьте первым!</p>";
      } else {
        comments.forEach((c) => {
          const div = document.createElement("div");
          div.className = "comment";
          div.innerHTML = `<strong>${c.name}</strong><div>${c.text}</div><div class="small">${new Date(c.ts).toLocaleString()}</div>`;
          commentsEl.appendChild(div);
        });
      }
      summary.textContent = `Комментариев: ${comments.length}`;
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const text = textInput.value.trim();
      if (!text) return;
      await fetch("/api/comments", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text }),
      });
      textInput.value = "";
      loadComments();
    });

    loadComments();
  </script>
</body>
</html>
